<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	template="/templates/template-general.xhtml">

	<ui:define name="titulo">ShareMyTrip-Listado de viajes
	</ui:define>

	<ui:define name="menubar">
		<p:menubar>
			<p:menuitem value="ShareMyTrip" disabled="true">
			</p:menuitem>
			<p:menuitem value="Casa" action="#{viajes.cargarViajesUsuario}">
			</p:menuitem>
			<p:menuitem style="position:absolute;right:10px;" value="Cerrar Sesión"
				action="#{login.cerrarSesion}">
			</p:menuitem>
		</p:menubar>
	</ui:define>
	<ui:define name="cuerpo">
		<br/><br/>
		<p:dataTable var="trip" value="#{viajes.trips}" style="width:100%">
			<f:facet name="header">Listado viajes</f:facet>
			<p:column>
				<f:facet name="header">Id viaje</f:facet>#{trip.id}</p:column>
			<p:column>
				<f:facet name="header">Fecha Cierre</f:facet>
				<h:outputText value="#{trip.closingDate}">
				<f:convertDateTime pattern="d/MMM/yyyy  HH:mm"/>
				</h:outputText></p:column>
			<p:column>
				<f:facet name="header">Fecha Llegada</f:facet>
				<h:outputText value="#{trip.arrivalDate}">
				<f:convertDateTime pattern="d/MMM/yyyy  HH:mm"/>
				</h:outputText></p:column>
			<p:column>
				<f:facet name="header">Fecha Salida</f:facet>
				<h:outputText value="#{trip.departureDate}">
				<f:convertDateTime pattern="d/MMM/yyyy  HH:mm"/>
				</h:outputText></p:column>
			<p:column>
				<f:facet name="header">Ciudad Origen</f:facet>#{trip.departure.city}</p:column>
			<p:column>
				<f:facet name="header">País Origen</f:facet>#{trip.departure.country}</p:column>
			<p:column>
				<f:facet name="header">Ciudad Destino</f:facet>#{trip.destination.city}</p:column>
			<p:column>
				<f:facet name="header">País Destino</f:facet>#{trip.destination.country}</p:column>
			<p:column>
				<f:facet name="header">Plazas Libres</f:facet>#{trip.availablePax}</p:column>
			<p:column>
				<f:facet name="header">Precio</f:facet>#{trip.estimatedCost}</p:column>
			<p:column>
				<f:facet name="header">Estado</f:facet>#{trip.status}</p:column>
			<p:column>
				<f:facet name="header">Pasajeros</f:facet>
				<p:commandLink id="verUsersBtn" actionListener="#{sessionuser.cargarPasajeros(trip)}" 
				value="Ver" />
				<p:overlayPanel id="moviePanel" hideEffect="fade" for="verUsersBtn"
				dynamic="true" style="width:80%" showCloseIcon="true">
        			<p:dataTable var="user" value="#{sessionuser.pasajeros}" rows="5">
            			<p:column headerText="Nombre">
                			<h:outputText value="#{user.name}" />
            			</p:column>
            			<p:column headerText="Apellidos">
                			<h:outputText value="#{user.surname}" />
            			</p:column>
            			<p:column headerText="Email">
                			<h:outputText value="#{user.email}" />
            			</p:column>
        			</p:dataTable>
   			 	</p:overlayPanel>
			</p:column>
			<p:column>
				<f:facet name="header">Promotor</f:facet>#{trip.promoterId}</p:column>
			<p:column>
				<f:facet name="header">Solicitar plaza</f:facet>
				<p:commandLink id="solicitarPlaza" action="#{viajes.solicitarPlaza(trip)}"
				 value="Solicitar"></p:commandLink>
			</p:column>
		</p:dataTable>
	</ui:define>
	<ui:define name="pie">
		<ui:include src="/snippets/footer.xhtml" />
	</ui:define>
</ui:composition>